//---------------------------------------------------------------------------


#pragma hdrstop

#include "appParamList.h"
#include "exceptionlog.h"
#include "GenerateQuoteEmailToken.h"
#include "checkAppParam.h"
#include "vcl.h"
#include "GetHMAC.h"


//---------------------------------------------------------------------------

#define APP_PARAM_CLOSER_QUOTEEMAILTOKENKEY 25

AnsiString GenerateQuoteEmailToken(long MeasureNum, long QuoteID, TDateTime CalcDateTime)
{
AnsiString emailToken = "";
 try
	{
	   AnsiString key = GetAppParamValue(APP_PARAM_CLOSER_QUOTEEMAILTOKENKEY).c_str();
	   CalcDateTime = CalcDateTime.FormatString("mmddyyHHNNSS");
	   AnsiString message = message.sprintf("%d,%d,%m/%d/%Y %H:%M:%S", QuoteID, MeasureNum, CalcDateTime).c_str();
	   emailToken =  GetHMACSHA256(message,key).c_str();
	}
 catch (Exception &e)
	{
	ExceptionLog(_APPLICATION_NAME, "GenerateQuoteEmailToken", e.Message);
	}
    
  return emailToken;

}

#pragma package(smart_init)